sap.ui.define(["./BaseController","../model/formatter","sap/ui/model/json/JSONModel","sap/base/strings/capitalize","sap/m/library"],function(t,e,a,r,n){"use strict";var i=n.URLHelper;return t.extend("gruene.ueberherrn.controller.StandByDuty",{formatter:e,URLHelper:i,_aDutyTypes:["doctor","pediatrist","dentist","oculist","otorhinolaryngologist","pharmacy","vet"],onInit:function(){this._initModel();this._setDutyItems()},_initModel:function(){var t=this.getResourceBundle();var n=this._getStartEndDate();var i=e.dateWithoutYear(n.start)+" â€’ "+e.dateWithoutYear(n.end);var o=[];for(var s=0,y=this._aDutyTypes.length;s<y;s++){o.push({dutyType:this._aDutyTypes[s],dutyTypeText:t.getText("dutyType"+r(this._aDutyTypes[s])),dutyTime:"",name:"",phone:"",phone2:"",longitude:"",latitude:""})}this.setModel(new a({dutyTimeFrame:i,dutyItems:o}),"standByDuty")},_getStartEndDate:function(){var t=new Date;var e=this._getDiffDaysToStart(t.getDay());var a=new Date(t.getTime()-e*24*60*60*1e3);var r=new Date(a.getFullYear(),a.getMonth(),a.getDate());var n=new Date(r.getTime()+6*24*60*60*1e3);return{start:r,end:n}},_getDiffDaysToStart:function(t){return t>=5?t-5:t-5+7},_setDutyItems:function(){var t=this.getModel("standByDuty");var e=t.getProperty("/dutyItems");var a=new Date;var r=a.getDay();var n=this._getDiffDaysToStart(r);this.getOwnerComponent().getStandByDutyData().then(a=>{var i=a.dutyContact;var o=a.dutyCycle;for(var s=0,y=e.length;s<y;s++){var u=o[e[s].dutyType];if(!u){continue}var d="";var g=[];for(var l in u){if(u[l].indexOf(r)>-1){d=l;g=u[l];break}var h=7;u[l].forEach(t=>{var e=this._getDiffDaysToStart(t);if(e-n>=0&&e-n<h){d=l;g=u[l];h=e-n}})}if(!d){d=l;g=u[l]}e[s].dutyTime=this._getDutyTime(g);if(i[d]){e[s].name=i[d].name;e[s].phone=i[d].phone;e[s].phone2=i[d].phone2;e[s].longitude=i[d].longitude;e[s].latitude=i[d].latitude}else{e[s].name=d}}t.setProperty("/dutyItems",e)})},_getDutyTime:function(t){var a="";if(t.length===1){var r=this._getDateByWeekday(t[0]);a=e.getWeekdayLong(r)+" "+e.dateFull(r)}else if(t.length===2){var n=this._getDateByWeekday(t[0]);var i=this._getDateByWeekday(t[1]);a=e.getWeekdayShort(n)+" "+e.dateFull(n)+" / "+e.getWeekdayShort(i)+" "+e.dateFull(i)}else{var o=new Date;a=e.getWeekdayLong(o)+" "+e.dateFull(o)}return a},_getDateByWeekday:function(t){var e=this._getStartEndDate();var a=this._getDiffDaysToStart(t);return new Date(e.start.getTime()+a*24*60*60*1e3)},onMapButtonPress:function(t){var e=t.getSource().getBindingContext("standByDuty");var a=e.getProperty("name");var r=e.getProperty("longitude");var n=e.getProperty("latitude");if(this.getModel("device").getProperty("/os/ios")){var o="http://maps.apple.com/?ll="+n+","+r+"&q="+a}else{o="geo:0,0?q="+n+","+r+"("+a+")"}i.redirect(o)}})});